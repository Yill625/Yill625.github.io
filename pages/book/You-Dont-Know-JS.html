<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>你不知道的 JavaScript（上） | 亮亮</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/learn.svg">
    <meta name="description" content="易亮亮前端文章记录">
    <meta name="keywords" content="易亮亮的博客,易亮亮,亮亮,blog,,博客,前端">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.70c409ff.css" as="style"><link rel="preload" href="/assets/js/app.927f4539.js" as="script"><link rel="preload" href="/assets/js/2.c84a9f48.js" as="script"><link rel="preload" href="/assets/js/101.024d4823.js" as="script"><link rel="prefetch" href="/assets/js/10.eb0a33b1.js"><link rel="prefetch" href="/assets/js/100.e1d56ef1.js"><link rel="prefetch" href="/assets/js/102.36e1fd39.js"><link rel="prefetch" href="/assets/js/103.d33bedee.js"><link rel="prefetch" href="/assets/js/104.82d87d0c.js"><link rel="prefetch" href="/assets/js/105.0d8699fb.js"><link rel="prefetch" href="/assets/js/106.497834b9.js"><link rel="prefetch" href="/assets/js/107.a97985cd.js"><link rel="prefetch" href="/assets/js/108.0883c487.js"><link rel="prefetch" href="/assets/js/109.d65677d6.js"><link rel="prefetch" href="/assets/js/11.f1f00ec3.js"><link rel="prefetch" href="/assets/js/110.fe177146.js"><link rel="prefetch" href="/assets/js/111.b4c33f6c.js"><link rel="prefetch" href="/assets/js/112.b1357c95.js"><link rel="prefetch" href="/assets/js/113.719d244b.js"><link rel="prefetch" href="/assets/js/114.60e7b2fc.js"><link rel="prefetch" href="/assets/js/115.7c8eeae5.js"><link rel="prefetch" href="/assets/js/116.e5ac0a29.js"><link rel="prefetch" href="/assets/js/117.500db8c6.js"><link rel="prefetch" href="/assets/js/118.93880f16.js"><link rel="prefetch" href="/assets/js/119.ed86bda1.js"><link rel="prefetch" href="/assets/js/12.56ed9763.js"><link rel="prefetch" href="/assets/js/120.54628620.js"><link rel="prefetch" href="/assets/js/121.bdbdf9b1.js"><link rel="prefetch" href="/assets/js/122.8cc670e6.js"><link rel="prefetch" href="/assets/js/123.02f14324.js"><link rel="prefetch" href="/assets/js/124.a2481399.js"><link rel="prefetch" href="/assets/js/125.6cc66e08.js"><link rel="prefetch" href="/assets/js/126.f0ac7929.js"><link rel="prefetch" href="/assets/js/127.94f044a6.js"><link rel="prefetch" href="/assets/js/128.c0117953.js"><link rel="prefetch" href="/assets/js/129.02c2417c.js"><link rel="prefetch" href="/assets/js/13.f8abfa44.js"><link rel="prefetch" href="/assets/js/130.0b3b6551.js"><link rel="prefetch" href="/assets/js/131.72fb1358.js"><link rel="prefetch" href="/assets/js/132.a49e3231.js"><link rel="prefetch" href="/assets/js/133.0f97f3ff.js"><link rel="prefetch" href="/assets/js/134.321bf4b4.js"><link rel="prefetch" href="/assets/js/135.a51d69e9.js"><link rel="prefetch" href="/assets/js/136.64e31e71.js"><link rel="prefetch" href="/assets/js/137.e03a2a14.js"><link rel="prefetch" href="/assets/js/138.59c41d5d.js"><link rel="prefetch" href="/assets/js/139.6d6c6139.js"><link rel="prefetch" href="/assets/js/14.1090e00f.js"><link rel="prefetch" href="/assets/js/140.26fce851.js"><link rel="prefetch" href="/assets/js/141.cdbde02e.js"><link rel="prefetch" href="/assets/js/142.e68f649e.js"><link rel="prefetch" href="/assets/js/143.d083d05f.js"><link rel="prefetch" href="/assets/js/144.02117a17.js"><link rel="prefetch" href="/assets/js/145.bce38a89.js"><link rel="prefetch" href="/assets/js/146.4a51ca61.js"><link rel="prefetch" href="/assets/js/147.71ba05f8.js"><link rel="prefetch" href="/assets/js/148.d56d8c0c.js"><link rel="prefetch" href="/assets/js/149.af3be915.js"><link rel="prefetch" href="/assets/js/15.9e283874.js"><link rel="prefetch" href="/assets/js/150.568c169f.js"><link rel="prefetch" href="/assets/js/151.da760c7b.js"><link rel="prefetch" href="/assets/js/152.f0bcd6cb.js"><link rel="prefetch" href="/assets/js/153.c9f0c7bb.js"><link rel="prefetch" href="/assets/js/154.cd28be3d.js"><link rel="prefetch" href="/assets/js/155.baafb041.js"><link rel="prefetch" href="/assets/js/156.3c34f1a5.js"><link rel="prefetch" href="/assets/js/157.345717ff.js"><link rel="prefetch" href="/assets/js/158.822bce6e.js"><link rel="prefetch" href="/assets/js/159.59ba5c58.js"><link rel="prefetch" href="/assets/js/16.bfca1832.js"><link rel="prefetch" href="/assets/js/160.d38bd1af.js"><link rel="prefetch" href="/assets/js/161.298c36f9.js"><link rel="prefetch" href="/assets/js/162.2a51598b.js"><link rel="prefetch" href="/assets/js/163.7040c5fe.js"><link rel="prefetch" href="/assets/js/164.6a7ee807.js"><link rel="prefetch" href="/assets/js/165.d82df432.js"><link rel="prefetch" href="/assets/js/166.bcc2d76e.js"><link rel="prefetch" href="/assets/js/167.93d8cf91.js"><link rel="prefetch" href="/assets/js/168.62f1bc9e.js"><link rel="prefetch" href="/assets/js/169.e6f102ca.js"><link rel="prefetch" href="/assets/js/17.187d10da.js"><link rel="prefetch" href="/assets/js/170.08f846b8.js"><link rel="prefetch" href="/assets/js/171.380736b0.js"><link rel="prefetch" href="/assets/js/172.b4f8d75d.js"><link rel="prefetch" href="/assets/js/173.6a387f78.js"><link rel="prefetch" href="/assets/js/174.63b38866.js"><link rel="prefetch" href="/assets/js/175.3dfb7577.js"><link rel="prefetch" href="/assets/js/176.1bf3f6ab.js"><link rel="prefetch" href="/assets/js/177.3b840fac.js"><link rel="prefetch" href="/assets/js/178.1859838a.js"><link rel="prefetch" href="/assets/js/179.ae8b0670.js"><link rel="prefetch" href="/assets/js/18.1d3ae1e0.js"><link rel="prefetch" href="/assets/js/180.d1907a31.js"><link rel="prefetch" href="/assets/js/19.b1b11f84.js"><link rel="prefetch" href="/assets/js/20.6c37c162.js"><link rel="prefetch" href="/assets/js/21.5228f8e1.js"><link rel="prefetch" href="/assets/js/22.3c4547d4.js"><link rel="prefetch" href="/assets/js/23.67f39cef.js"><link rel="prefetch" href="/assets/js/24.2c3bb5f8.js"><link rel="prefetch" href="/assets/js/25.9cf5bc4a.js"><link rel="prefetch" href="/assets/js/26.db6567a3.js"><link rel="prefetch" href="/assets/js/27.d8c2fc5b.js"><link rel="prefetch" href="/assets/js/28.93dedd08.js"><link rel="prefetch" href="/assets/js/29.ddeb43d9.js"><link rel="prefetch" href="/assets/js/3.8ce6dbcf.js"><link rel="prefetch" href="/assets/js/30.c4ab9f38.js"><link rel="prefetch" href="/assets/js/31.b0822bb3.js"><link rel="prefetch" href="/assets/js/32.76abedef.js"><link rel="prefetch" href="/assets/js/33.b49fa513.js"><link rel="prefetch" href="/assets/js/34.d72c3309.js"><link rel="prefetch" href="/assets/js/35.92b57a66.js"><link rel="prefetch" href="/assets/js/36.d30ef8c0.js"><link rel="prefetch" href="/assets/js/37.c8cce37d.js"><link rel="prefetch" href="/assets/js/38.b5876ecf.js"><link rel="prefetch" href="/assets/js/39.77d6d7ee.js"><link rel="prefetch" href="/assets/js/4.7de92415.js"><link rel="prefetch" href="/assets/js/40.d03608df.js"><link rel="prefetch" href="/assets/js/41.96f32b4d.js"><link rel="prefetch" href="/assets/js/42.3d3da6fa.js"><link rel="prefetch" href="/assets/js/43.a081a0c7.js"><link rel="prefetch" href="/assets/js/44.19983942.js"><link rel="prefetch" href="/assets/js/45.44d21e76.js"><link rel="prefetch" href="/assets/js/46.96bb8c4e.js"><link rel="prefetch" href="/assets/js/47.96035db7.js"><link rel="prefetch" href="/assets/js/48.3f4399e6.js"><link rel="prefetch" href="/assets/js/49.b357c3c2.js"><link rel="prefetch" href="/assets/js/5.da8f20de.js"><link rel="prefetch" href="/assets/js/50.deec3c99.js"><link rel="prefetch" href="/assets/js/51.b0c9c24e.js"><link rel="prefetch" href="/assets/js/52.459ae9fb.js"><link rel="prefetch" href="/assets/js/53.97410df8.js"><link rel="prefetch" href="/assets/js/54.3a6ad028.js"><link rel="prefetch" href="/assets/js/55.eae10b43.js"><link rel="prefetch" href="/assets/js/56.c38115d8.js"><link rel="prefetch" href="/assets/js/57.0d253444.js"><link rel="prefetch" href="/assets/js/58.45d5a84a.js"><link rel="prefetch" href="/assets/js/59.a95980bc.js"><link rel="prefetch" href="/assets/js/6.323ae50b.js"><link rel="prefetch" href="/assets/js/60.d58975b2.js"><link rel="prefetch" href="/assets/js/61.86d3e494.js"><link rel="prefetch" href="/assets/js/62.850e2c10.js"><link rel="prefetch" href="/assets/js/63.9301367e.js"><link rel="prefetch" href="/assets/js/64.e50abc5d.js"><link rel="prefetch" href="/assets/js/65.af8d47cd.js"><link rel="prefetch" href="/assets/js/66.5ab6fee2.js"><link rel="prefetch" href="/assets/js/67.4a231cd5.js"><link rel="prefetch" href="/assets/js/68.00a267c5.js"><link rel="prefetch" href="/assets/js/69.82140bd5.js"><link rel="prefetch" href="/assets/js/7.c539c6e2.js"><link rel="prefetch" href="/assets/js/70.a2269691.js"><link rel="prefetch" href="/assets/js/71.77c08220.js"><link rel="prefetch" href="/assets/js/72.d0b636e9.js"><link rel="prefetch" href="/assets/js/73.c40339fc.js"><link rel="prefetch" href="/assets/js/74.7097cdaa.js"><link rel="prefetch" href="/assets/js/75.c4cada04.js"><link rel="prefetch" href="/assets/js/76.952b04c1.js"><link rel="prefetch" href="/assets/js/77.e4256880.js"><link rel="prefetch" href="/assets/js/78.838126e0.js"><link rel="prefetch" href="/assets/js/79.896d224e.js"><link rel="prefetch" href="/assets/js/8.336f7a9b.js"><link rel="prefetch" href="/assets/js/80.0972ab09.js"><link rel="prefetch" href="/assets/js/81.67c86362.js"><link rel="prefetch" href="/assets/js/82.f4726785.js"><link rel="prefetch" href="/assets/js/83.87dc4462.js"><link rel="prefetch" href="/assets/js/84.a2b0db00.js"><link rel="prefetch" href="/assets/js/85.7b497cc9.js"><link rel="prefetch" href="/assets/js/86.ea98e5db.js"><link rel="prefetch" href="/assets/js/87.ac616b2d.js"><link rel="prefetch" href="/assets/js/88.11b18acc.js"><link rel="prefetch" href="/assets/js/89.7e01912c.js"><link rel="prefetch" href="/assets/js/9.544a5a67.js"><link rel="prefetch" href="/assets/js/90.76d8500c.js"><link rel="prefetch" href="/assets/js/91.c3d95b52.js"><link rel="prefetch" href="/assets/js/92.47340848.js"><link rel="prefetch" href="/assets/js/93.e78e3a68.js"><link rel="prefetch" href="/assets/js/94.036dfdc4.js"><link rel="prefetch" href="/assets/js/95.f989e21a.js"><link rel="prefetch" href="/assets/js/96.8a877ad1.js"><link rel="prefetch" href="/assets/js/97.96d0ac93.js"><link rel="prefetch" href="/assets/js/98.6e8fc174.js"><link rel="prefetch" href="/assets/js/99.79347091.js">
    <link rel="stylesheet" href="/assets/css/0.styles.70c409ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">亮亮</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pages/algorithm/index.html" class="nav-link">
  🎯算法
</a></div><div class="nav-item"><a href="/pages/book/index.html" class="nav-link">
  📚阅读
</a></div><div class="nav-item"><a href="/pages/interview/index.html" class="nav-link">
  🥳前端
</a></div><div class="nav-item"><a href="https://github.com/Yill625" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pages/algorithm/index.html" class="nav-link">
  🎯算法
</a></div><div class="nav-item"><a href="/pages/book/index.html" class="nav-link">
  📚阅读
</a></div><div class="nav-item"><a href="/pages/interview/index.html" class="nav-link">
  🥳前端
</a></div><div class="nav-item"><a href="https://github.com/Yill625" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>书单</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端书单</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/book/vue3.html" class="sidebar-link"> 📚 Vue.js 设计与实现</a></li><li><a href="/pages/book/Web-Frontend-Performance-Optimization.html" class="sidebar-link"> 📚 Web 前端性能优化</a></li><li><a href="/pages/book/You-Dont-Know-JS.html" aria-current="page" class="active sidebar-link">📚 你不知道的JavaScript（上卷）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第一部分" class="sidebar-link">第一部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-1-章-作用域是什么" class="sidebar-link">第 1 章　作用域是什么</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-2-章-词法作用域" class="sidebar-link">第 2 章　词法作用域</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-3-章-函数作用域和块作用域" class="sidebar-link">第 3 章　函数作用域和块作用域</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-4-章-提升" class="sidebar-link">第 4 章　提升</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-5-章-作用域闭包" class="sidebar-link">第 5 章　作用域闭包</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第二部分" class="sidebar-link">第二部分</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-1-章-关于-this" class="sidebar-link">第 1 章　关于 this</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-2-章-this-全面解析" class="sidebar-link">第 2 章　 this 全面解析</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-3-章-对象" class="sidebar-link">第 3 章　对象</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-4-章-混合对象-类" class="sidebar-link">第 4 章　混合对象“类”</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-5-章-原型" class="sidebar-link">第 5 章　原型</a></li><li class="sidebar-sub-header"><a href="/pages/book/You-Dont-Know-JS.html#第-6-章-行为委托" class="sidebar-link">第 6 章　行为委托</a></li></ul></li></ul></li><li><a href="/pages/book/You-Dont-Know-JS-2nd.html" class="sidebar-link">📚 你不知道的JavaScript（中卷）</a></li><li><a href="/pages/book/CssSecrets.html" class="sidebar-link">📚 Css 揭秘</a></li><li><a href="/pages/book/ProfessionalJavaScriptForWebDevelopers.html" class="sidebar-link">📚 JavaScript高级程序设计（第4版）</a></li><li><a href="/pages/book/node.html" class="sidebar-link">📚 深入浅出nodejs</a></li><li><a href="/pages/book/github.html" class="sidebar-link">📚 GitHub的入门与实践</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>掘金小册</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="你不知道的-javascript-上"><a href="#你不知道的-javascript-上" class="header-anchor">#</a> 你不知道的 JavaScript（上）</h1> <h2 id="第一部分"><a href="#第一部分" class="header-anchor">#</a> 第一部分</h2> <h3 id="第-1-章-作用域是什么"><a href="#第-1-章-作用域是什么" class="header-anchor">#</a> 第 1 章　作用域是什么</h3> <h4 id="编译原理"><a href="#编译原理" class="header-anchor">#</a> 编译原理</h4> <p>在传统编译语言的流程中，程序中的一段源代码在执行之前会经历三个步骤，统称为“编译”</p> <ul><li>分词/词法分析 分单词</li> <li>解析/语法分析 ast</li> <li>代码生成 分配内存</li></ul> <h4 id="理解作用域"><a href="#理解作用域" class="header-anchor">#</a> 理解作用域</h4> <p>参与者</p> <ul><li>引擎 从头到尾负责整个 JavaScript 程序的编译及执行过程。</li> <li>编译器 引擎的好朋友之一，负责语法分析及代码生成等脏活累活（详见前一节的内容）。</li> <li>作用域 引擎的另一位好朋友，负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。</li></ul> <p>总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值</p> <p>LHS 和 RHS</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// RHS 查找一个马上要用的值  查找</span>
<span class="token comment">// LHS 需要把一个值放到一个地方 赋值</span>
</code></pre></div><p>https://www.jianshu.com/p/ecb1c72fd902</p> <h4 id="作用域嵌套"><a href="#作用域嵌套" class="header-anchor">#</a> 作用域嵌套</h4> <p>引擎从当前的执行作用域开始查找变量，如果找不到，就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。
LHS 和 RHS 引用都会在当前楼层进行查找</p> <h4 id="异常"><a href="#异常" class="header-anchor">#</a> 异常</h4> <p>为什么区分 LHS 和 RHS 是一件重要的事情？</p> <p>因为当无法找到变量时 处理结果可能不一致</p> <p>在 非严格模式/严格模式 下 如果 RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出 ReferenceError 异常
在 非严格模式下 当引擎执行 LHS 查询时，如果在顶层（全局作用域）中也无法找到目标变量，全局作用域中就会创建一个具有该名称的变量，并将其返还给引擎
在 非严格模式下 LHS 查询失败时，并不会创建并返回一个全局变量，引擎会抛出同 RHS 查询失败时类似的 ReferenceError 异常</p> <p>ReferenceError 同作用域判别失败相关，而 TypeError 则代表作用域判别成功了，但是对结果的操作是非法或不合理的。</p> <h3 id="第-2-章-词法作用域"><a href="#第-2-章-词法作用域" class="header-anchor">#</a> 第 2 章　词法作用域</h3> <p>作用域共有两种主要的工作模型</p> <p>词法作用域</p> <p>动态作用域</p> <h4 id="词法阶段"><a href="#词法阶段" class="header-anchor">#</a> 词法阶段</h4> <p>什么叫词法？</p> <p>编译器的第一个工作阶段叫作词法化 词法化的过程会对源代码中的字符进行检查，如果是有状态的解析过程，还会赋予单词语义</p> <p>词法作用域就是定义在词法阶段的作用域</p> <p>词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的，因此当词法分析器处理代码时会保持作用域不变（大部分情况下是这样的）</p> <p>无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。</p> <h4 id="欺骗词法-欺骗词法作用域会导致性能下降"><a href="#欺骗词法-欺骗词法作用域会导致性能下降" class="header-anchor">#</a> 欺骗词法 欺骗词法作用域会导致性能下降</h4> <ul><li>eval
JavaScript 中的 eval(..)函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。</li></ul> <p>setTimeout setInterval new Function() 都可以接收一个代码字符串 来运行一段代码</p> <p>在程序中动态生成代码的使用场景非常罕见，因为它所带来的好处无法抵消性能上的损失</p> <ul><li>with</li></ul> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzi1da1lmqj217f0u0gne.jpg" alt="with"></p> <p>总结</p> <p>词法作用域意味着作用域是由书写代码时函数声明的位置来决定的。编译的词法分析阶段基本能够知道全部标识符在哪里以及是如何声明的，从而能够预测在执行过程中如何对它们进行查找。</p> <h3 id="第-3-章-函数作用域和块作用域"><a href="#第-3-章-函数作用域和块作用域" class="header-anchor">#</a> 第 3 章　函数作用域和块作用域</h3> <h4 id="函数中的作用域"><a href="#函数中的作用域" class="header-anchor">#</a> 函数中的作用域</h4> <p>属于这个函数的全部变量都可以在整个函数的范围内使用及复用（事实上在嵌套的作用域中也可以使用）。这种设计方案是非常有用的，能充分利用 JavaScript 变量可以根据需要改变值类型的“动态”特性</p> <h4 id="函数作用域"><a href="#函数作用域" class="header-anchor">#</a> 函数作用域</h4> <p>区分<strong>函数声明</strong>和<strong>函数表达式</strong>最简单的方法是看 function 关键字出现在声明中的位置（不仅仅是一行代码，而是整个声明中的位置）。如果 function 是声明中的第一个词，那么就是一个函数声明，否则就是一个函数表达式。</p> <p>函数声明和函数表达式之间最重要的区别是它们的名称标识符将会绑定在何处。</p> <p>函数表达式可以是匿名的，而函数声明则不可以省略函数名——在 JavaScript 的语法中这是非法的</p> <h4 id="块作用域"><a href="#块作用域" class="header-anchor">#</a> 块作用域</h4> <p>表面上看 JavaScript 并没有块作用域的相关功能 var</p> <p>with</p> <p>同时也是块作用域的一个例子（块作用域的一种形式），用 with 从对象中创建出的作用域仅在 with 声明中而非外部作用域中有效。</p> <p>try/catch</p> <p>会创建一个块作用域，其中声明的变量仅在 catch 内部有效。</p> <p>let</p> <p>let 为其声明的变量隐式地劫持了所在的块作用域</p> <p>const</p> <p>用来创建块作用域变量，但其值是固定的（常量）。之后任何试图修改值的操作都会引起错误</p> <h3 id="第-4-章-提升"><a href="#第-4-章-提升" class="header-anchor">#</a> 第 4 章　提升</h3> <p>作用域同其中的变量声明出现的位置有某种微妙的联系</p> <p>包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。</p> <ul><li>函数声明直接提前</li></ul> <p>一个普通块内部的函数声明通常会被提升到所在作用域的顶部</p> <p>函数优先 函数声明比赋值优先 函数重复声明会覆盖 函数和普通声明已函数声明为准</p> <p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzira31nmdj21by0kigmp.jpg" alt=""></p> <p>总结</p> <p>我们习惯将 var a = 2；看作一个声明，而实际上 JavaScript 引擎并不这么认为。它将 var a 和 a = 2 当作两个单独的声明，第一个是编译阶段的任务，而第二个则是执行阶段的任务。</p> <p>这意味着无论作用域中的声明出现在什么地方，都将在代码本身被执行前首先进行处理。可以将这个过程形象地想象成所有的声明（变量和函数）都会被“移动”到各自作用域的最顶端，这个过程被称为提升。</p> <p>声明本身会被提升，而包括函数表达式的赋值在内的赋值操作并不会提升。</p> <p>要注意避免重复声明，特别是当普通的 var 声明和函数声明混合在一起的时候，否则会引起很多危险的问题！</p> <h3 id="第-5-章-作用域闭包"><a href="#第-5-章-作用域闭包" class="header-anchor">#</a> 第 5 章　作用域闭包</h3> <p>谈闭包 先要谈作用域</p> <p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行</p> <p>一个函数执行完成以后 在某个时间 另外一个函数执行会用到第一个函数内部的作用域变量 这就是闭包</p> <p>只要使用了回调函数，实际上就是在使用闭包！ 因为回调的作用就是等待被触发 触发就会使用当时函数作用域</p> <h4 id="循环和闭包"><a href="#循环和闭包" class="header-anchor">#</a> 循环和闭包</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缺陷是我们试图假设循环中的每个迭代在运行时都会给自己“捕获”一个 i 的副本。但是根据作用域的工作原理，实际情况是尽管循环中的五个函数是在各个迭代中分别定义的，但是它们都被封闭在一个共享的全局作用域中，因此实际上只有一个 i。</p> <p>立即执行函数会自己形成一个词法作用域</p> <p>https://weread.qq.com/web/reader/8c632230715c01a18c683d8ke3632bd0222e369853df322</p> <h4 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h4> <p>如果要更简单的描述，模块模式需要具备两个必要条件。</p> <ol><li>必须有外部的封闭函数，该函数必须至少被调用一次（每次调用都会创建一个新的模块实例）</li> <li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>回调 和 模块 是 闭包的两大模式</p></div> <h4 id="动态作用域"><a href="#动态作用域" class="header-anchor">#</a> 动态作用域</h4> <p>主要区别：词法作用域是在写代码或者说定义时确定的，而动态作用域是在运行时确定的。（this 也是！）词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。</p> <p>词法作用域 静态作用域 书写的时候就确定了变量的一个查找方式</p> <p>this 动态 需要按照运行时候调用的情况去分别找到上下文</p> <h2 id="第二部分"><a href="#第二部分" class="header-anchor">#</a> 第二部分</h2> <h3 id="第-1-章-关于-this"><a href="#第-1-章-关于-this" class="header-anchor">#</a> 第 1 章　关于 this</h3> <p>this 的作用就是 减少函数传参上下文对象？？</p> <p>this 提供了一种更优雅的方式来隐式“传递”一个对象引用，因此可以将 API 设计得更加简洁并且易于复用。</p> <p>显式传递上下文对象会让代码变得越来越混乱，使用 this 则不会这样。当我们介绍对象和原型时，你就会明白函数可以自动引用合适的上下文对象有多重要</p> <p>每当你想要把 this 和词法作用域的查找混合使用时，一定要提醒自己，这是无法实现的</p> <h4 id="this-到底是什么"><a href="#this-到底是什么" class="header-anchor">#</a> this 到底是什么</h4> <p>this 是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于函数调用时的各种条件。this 的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</p> <p>this 实际上是在函数被调用时发生的绑定，它指向什么完全取决于函数在哪里被调用。</p> <p>每个函数的 this 是在调用时被绑定的，完全取决于函数的调用位置（也就是函数的调用方法）</p> <h3 id="第-2-章-this-全面解析"><a href="#第-2-章-this-全面解析" class="header-anchor">#</a> 第 2 章　 this 全面解析</h3> <h4 id="绑定规则"><a href="#绑定规则" class="header-anchor">#</a> 绑定规则</h4> <ol><li><p>默认绑定 独立函数调用 指向全局 严格模式下 LHS 会失败无法查询 this 导致 TypeError: this is undefined</p></li> <li><p>隐式绑定 调用位置是否有上下文对象，或者说是否被某个对象拥有或者包含，不过这种说法可能会造成一些误导</p></li> <li><p>显示绑定 call apply bind</p></li> <li><p>new 绑定</p></li></ol> <p>实际上并不存在所谓的“构造函数”，只有对于函数的“构造调用</p> <ol start="5"><li>箭头函数的 this 指向他的词法作用域</li></ol> <h4 id="绑定例外"><a href="#绑定例外" class="header-anchor">#</a> 绑定例外</h4> <ul><li><p>显性绑定 第一个值 null</p></li> <li><p>间接引用 <code>(a.foo = b.foo)()</code> 函数的赋值返回函数
默认绑定来说，决定 this 绑定对象的并不是调用位置是否处于严格模式，而是函数体是否处于严格模式。如果函数体处于严格模式，this 会被绑定到 undefined，否则 this 会被绑定到全局对象。</p></li></ul> <h3 id="第-3-章-对象"><a href="#第-3-章-对象" class="header-anchor">#</a> 第 3 章　对象</h3> <p>创建对象的方式</p> <ol><li>字面创建 <strong>{a:123}</strong></li> <li>构造形式 <strong>new Object()</strong></li></ol> <p>基本数据类型</p> <p>string boolean number null undefined symbol bigint</p> <p>object</p> <p>内置对象</p> <p>String Number Boolean Object Function Array Date RegExp Error</p> <h4 id="内容"><a href="#内容" class="header-anchor">#</a> 内容</h4> <h4 id="深浅拷贝"><a href="#深浅拷贝" class="header-anchor">#</a> 深浅拷贝</h4> <h4 id="属性描述符"><a href="#属性描述符" class="header-anchor">#</a> 属性描述符</h4> <ul><li>value</li> <li>writable writable 决定是否可以修改属性的值。</li> <li>enumerable</li> <li>configurable</li></ul> <h4 id="存在性"><a href="#存在性" class="header-anchor">#</a> 存在性</h4> <p>in 操作符会检查属性是否在对象及其[[Prototype]]原型链中</p> <p>hasOwnProperty(..)只会检查属性是否在 myObject 对象中</p> <p>但是它实际上检查的是某个属性名是否存在。对于数组来说这个区别非常重要</p> <h4 id="可遍历性"><a href="#可遍历性" class="header-anchor">#</a> 可遍历性</h4> <p>在数组上应用 for..in 循环有时会产生出人意料的结果，因为这种枚举不仅会包含所有数值索引，还会包含所有可枚举属性。最好只在对象上应用 for..in 循环，如果要遍历数组就使用传统的 for 循环来遍历数值索引</p> <h3 id="第-4-章-混合对象-类"><a href="#第-4-章-混合对象-类" class="header-anchor">#</a> 第 4 章　混合对象“类”</h3> <h3 id="第-5-章-原型"><a href="#第-5-章-原型" class="header-anchor">#</a> 第 5 章　原型</h3> <h3 id="第-6-章-行为委托"><a href="#第-6-章-行为委托" class="header-anchor">#</a> 第 6 章　行为委托</h3> <p>**[[Prototype]]**机制就是指对象中的一个内部链接引用另一个对象</p> <p>JavaScript 中这个机制的本质就是对象之间的关联关系</p> <h4 id="面向委托设计"><a href="#面向委托设计" class="header-anchor">#</a> 面向委托设计</h4> <div class="language-js extra-class"><pre class="language-js"><code>Foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">who</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>me <span class="token operator">=</span> who
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">identify</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>me
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Bar <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span>

Bar<span class="token punctuation">.</span><span class="token function-variable function">speak</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">identify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> b1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span> <span class="token comment">// b1的原型对象是Bar b1.__proto__===Bar</span>
b1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">'b1'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> b2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span>
b2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">'b2'</span><span class="token punctuation">)</span>
b1<span class="token punctuation">.</span>speak
b2<span class="token punctuation">.</span>speak
</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzryvkdoc8j20fo07ojrq.jpg" alt=""></p> <h4 id="类与对象"><a href="#类与对象" class="header-anchor">#</a> 类与对象</h4> <p>把类当做一个对象来处理</p> <p>使用对象关联风格来编写代码时不需要把 Widget 和 Button 当作父类和子类。相反，Widget 只是一个对象，包含一组通用的函数，任何类型的控件都可以委托，Button 同样只是一个对象。（当然，它会通过委托关联到 Widget!）</p> <p>在委托设计模式中，除了建议使用不相同并且更具描述性的方法名之外，还要通过对象关联避免丑陋的显式伪多态调用（Widget.call 和 Widget.prototype.render.call），代之以简单的相对委托调用 this.init(..)和 this.insert(..)。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> father <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> son <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>father<span class="token punctuation">)</span>

son<span class="token punctuation">.</span><span class="token function-variable function">introduce</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

p1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>son<span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">'liang'</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">introduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="更简洁的设计"><a href="#更简洁的设计" class="header-anchor">#</a> 更简洁的设计</h4> <p>对象关联风格代码和行为委托设计模式的</p> <h4 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h4> <p>行为委托认为对象之间是兄弟关系，互相委托，而不是父类和子类的关系。JavaScript 的 <strong>[[Prototype]]</strong> 机制本质上就是行为委托机制。也就是说，我们可以选择在 JavaScript 中努力实现类机制（参见第 4 和第 5 章），也可以拥抱更自然的 <strong>[[Prototype]]</strong> 委托机制。</p> <p>当你只用对象来设计代码时，不仅可以让语法更加简洁，而且可以让代码结构更加清晰。对象关联（对象之前互相关联）是一种编码风格，它倡导的是直接创建和关联对象，不把它们抽象成类。对象关联可以用基于[[Prototype]]的行为委托非常自然地实现。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/8/2022, 8:13:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/book/Web-Frontend-Performance-Optimization.html" class="prev">
         📚 Web 前端性能优化
      </a></span> <span class="next"><a href="/pages/book/You-Dont-Know-JS-2nd.html">
        📚 你不知道的JavaScript（中卷）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.927f4539.js" defer></script><script src="/assets/js/2.c84a9f48.js" defer></script><script src="/assets/js/101.024d4823.js" defer></script>
  </body>
</html>
